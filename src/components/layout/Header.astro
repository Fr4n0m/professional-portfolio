---
import ThemeToggle from '@components/ThemeToggle.astro';
import type { HeaderItem } from '../../types/headerItem';
import type { Translations } from '../../types/translations';
import LanguageSelector from '@components/LanguageSelector.astro';
import LanguageToggle from '@components/LanguageToggle.astro';

const translations: Translations = Astro.props.translations;
const headerItems: HeaderItem[] = translations.headerItems;
const lang = Astro.props.lang;

// Información personal multilingüe
const personalInfo = {
	es: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Desarrollador Full Stack',
		email: 'fran11799@outlook.com',
		location: 'Málaga, España',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	'es-mx': {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Desarrollador Full Stack',
		email: 'fran11799@outlook.com',
		location: 'Málaga, España',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	en: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Full Stack Developer',
		email: 'fran11799@outlook.com',
		location: 'Málaga, Spain',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	'en-us': {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Full Stack Developer',
		email: 'fran11799@outlook.com',
		location: 'Málaga, Spain',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	fr: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Développeur Full Stack',
		email: 'fran11799@outlook.com',
		location: 'Málaga, Espagne',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	de: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Full Stack Entwickler',
		email: 'fran11799@outlook.com',
		location: 'Málaga, Spanien',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	it: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Sviluppatore Full Stack',
		email: 'fran11799@outlook.com',
		location: 'Málaga, Spagna',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	pt: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Desenvolvedor Full Stack',
		email: 'fran11799@outlook.com',
		location: 'Málaga, Espanha',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	zh: {
		name: 'Francisco José Rodríguez Martínez',
		role: '全栈开发者',
		email: 'fran11799@outlook.com',
		location: '马拉加，西班牙',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	ja: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'フルスタック開発者',
		email: 'fran11799@outlook.com',
		location: 'マラガ、スペイン',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	hi: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'फुल स्टैक डेवलपर',
		email: 'fran11799@outlook.com',
		location: 'मलागा, स्पेन',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	ar: {
		name: 'فرانسيسكو خوسيه رودريغيز مارتينيز',
		role: 'مطور Full Stack',
		email: 'fran11799@outlook.com',
		location: 'مالقة، إسبانيا',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	ru: {
		name: 'Франсиско Хосе Родригес Мартинес',
		role: 'Full Stack Разработчик',
		email: 'fran11799@outlook.com',
		location: 'Малага, Испания',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	ko: {
		name: 'Francisco José Rodríguez Martínez',
		role: '풀스택 개발자',
		email: 'fran11799@outlook.com',
		location: '말라가, 스페인',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	nl: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Full Stack Ontwikkelaar',
		email: 'fran11799@outlook.com',
		location: 'Málaga, Spanje',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	pl: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Programista Full Stack',
		email: 'fran11799@outlook.com',
		location: 'Malaga, Hiszpania',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	tr: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Full Stack Geliştirici',
		email: 'fran11799@outlook.com',
		location: 'Málaga, İspanya',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	},
	hv: {
		name: 'Francisco José Rodríguez Martínez',
		role: 'Full Stack Developer',
		email: 'fran11799@outlook.com',
		location: 'Málaga, España',
		specialties: 'React, Next.js, Node.js, Astro, TypeScript',
		additionalTech: 'Tailwind CSS, MongoDB, PostgreSQL, Git'
	}
};

const info = personalInfo[lang] || personalInfo.es;
---

<header
	class='fixed top-0 z-10 flex items-center justify-center w-full mx-auto'
>
	<!-- Header Desktop -->
	<nav
		class='hidden md:flex px-3 text-sm font-medium rounded-full flex-wrap m-3 ml-5 mr-5 p-1 mt-2 text-gray-500/90 dark:text-white/90 items-center justify-center bg-white/50 dark:bg-gray-800/90'
	>
		<div class='relative group'>
			<a href={lang === 'es' ? '/' : `/${lang}/`} class='appearance-none border-none flex hover:scale-110 transition-transform duration-200 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 mr-1'>
				<img
					src='/assets/images/Fr4n0m Photo.webp'
					alt='Fr4n0m photo'
					class='rounded-full w-5 h-5'
				/>
			</a>
			<!-- Tooltip con información personal -->
			<div class='absolute left-[-10px] top-12 invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all duration-300 ease-out transform translate-y-2 group-hover:translate-y-0 z-50'>
				<div class='bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 p-4 min-w-[320px]'>
					<!-- Imagen grande -->
					<div class='flex items-center space-x-4 mb-3'>
						<img
							src='/assets/images/Fr4n0m Photo.webp'
							alt='Fr4n0m photo'
							class='rounded-full w-16 h-16 ring-2 ring-primary/20 animate-scale-up'
						/>
						<div>
							<h3 class='font-bold text-lg dark:text-white'>{info.name}</h3>
							<p class='text-sm text-gray-600 dark:text-gray-400'>{info.role}</p>
						</div>
					</div>
					<!-- Información adicional -->
					<div class='space-y-2 text-sm'>
						<div class='flex items-center space-x-2'>
							<svg class='w-4 h-4 text-gray-500' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
								<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z'></path>
							</svg>
							<span class='text-gray-700 dark:text-gray-300'>{info.email}</span>
						</div>
						<div class='flex items-center space-x-2'>
							<svg class='w-4 h-4 text-gray-500' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
								<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z'></path>
								<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 11a3 3 0 11-6 0 3 3 0 016 0z'></path>
							</svg>
							<span class='text-gray-700 dark:text-gray-300'>{info.location}</span>
						</div>
						<div class='flex items-center space-x-2'>
							<svg class='w-4 h-4 text-gray-500' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
								<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 10V3L4 14h7v7l9-11h-7z'></path>
							</svg>
							<span class='text-gray-700 dark:text-gray-300'>{info.specialties}</span>
						</div>
						<div class='flex items-center space-x-2'>
							<svg class='w-4 h-4 text-gray-500' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
								<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4'></path>
							</svg>
							<span class='text-gray-700 dark:text-gray-300'>{info.additionalTech}</span>
						</div>
					</div>
					<!-- Flecha del tooltip -->
					<div class='absolute -top-2 left-6 w-4 h-4 bg-white dark:bg-gray-800 border-l border-t border-gray-200 dark:border-gray-700 transform rotate-45'></div>
				</div>
			</div>
		</div>
		{
			headerItems.map(item => (
				<a
					class='block px-2 py-2 transition text-nowrap dark:hover:text-yellow-300 hover:text-blue-800'
					aria-label={item.label}
					href={item.url}
					target={item.title === 'CV' ? '_blank' : '_self'}
				>
					{item.title}
				</a>
			))
		}
		<ThemeToggle />
		<LanguageToggle />
	</nav>

	<!-- Header Mobile -->
	<div class='md:hidden flex items-center justify-between w-full px-4 py-3'>
		<!-- Logo + Menu Button -->
		<div class='flex items-center space-x-2'>
			<button
				id='mobile-menu-button'
				class='p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors'
				aria-label='Toggle menu'
			>
				<svg id='menu-icon' class='w-6 h-6' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
					<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M4 6h16M4 12h16M4 18h16'></path>
				</svg>
				<svg id='close-icon' class='w-6 h-6 hidden' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
					<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 18L18 6M6 6l12 12'></path>
				</svg>
			</button>
			<a href={lang === 'es' ? '/' : `/${lang}/`} class='flex items-center'>
				<img
					src='/assets/images/Fr4n0m Photo.webp'
					alt='Fr4n0m photo'
					class='rounded-full w-8 h-8'
				/>
			</a>
		</div>

		<!-- Toggles -->
		<div class='flex items-center -mr-1'>
			<ThemeToggle />
			<LanguageToggle />
		</div>
	</div>

	<!-- Mobile Menu -->
	<div
		id='mobile-menu'
		class='hidden md:hidden fixed top-[60px] left-0 right-0 bg-white dark:bg-gray-800 shadow-lg overflow-y-auto max-h-[calc(100vh-60px)]'
	>
		<nav class='px-4 py-4'>
			{
				headerItems.map(item => (
					<a
						class='block px-3 py-3 mb-1 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors'
						aria-label={item.label}
						href={item.url}
						target={item.title === 'CV' ? '_blank' : '_self'}
					>
						{item.title}
					</a>
				))
			}
		</nav>
	</div>
</header>

<script>
	// Mobile menu functionality
	function initMobileMenu() {
		const mobileMenuButton = document.getElementById('mobile-menu-button');
		const mobileMenu = document.getElementById('mobile-menu');
		const menuIcon = document.getElementById('menu-icon');
		const closeIcon = document.getElementById('close-icon');
		
		if (!mobileMenuButton || !mobileMenu || !menuIcon || !closeIcon) return;
		
		let isOpen = false;
		
		mobileMenuButton.addEventListener('click', () => {
			isOpen = !isOpen;
			if (isOpen) {
				mobileMenu.classList.remove('hidden');
				menuIcon.classList.add('hidden');
				closeIcon.classList.remove('hidden');
			} else {
				mobileMenu.classList.add('hidden');
				menuIcon.classList.remove('hidden');
				closeIcon.classList.add('hidden');
			}
		});
		
		// Close menu when clicking outside
		document.addEventListener('click', (event) => {
			if (!mobileMenuButton.contains(event.target as Node) && 
				!mobileMenu.contains(event.target as Node) && isOpen) {
				isOpen = false;
				mobileMenu.classList.add('hidden');
				menuIcon.classList.remove('hidden');
				closeIcon.classList.add('hidden');
			}
		});
		
		// Close menu when clicking on a link
		const menuLinks = mobileMenu.querySelectorAll('a');
		menuLinks.forEach(link => {
			link.addEventListener('click', () => {
				isOpen = false;
				mobileMenu.classList.add('hidden');
				menuIcon.classList.remove('hidden');
				closeIcon.classList.add('hidden');
			});
		});
	}

	// Navigation highlighting
	document.addEventListener('DOMContentLoaded', () => {
		// Initialize mobile menu
		initMobileMenu();
		
		// Navigation highlighting
		const sections = document.querySelectorAll('section[data-section]');
		const navItems = document.querySelectorAll('header nav a');

		if (sections.length === 0) {
			console.error('No se encontraron secciones con ID en el DOM');
			return;
		}

		const callback = (entries: any[]) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					navItems.forEach(item => {
						if (
							item.getAttribute('aria-label') === entry.target.id
						) {
							item.classList.add('dark:text-yellow-300');
							item.classList.add('text-blue-800');
						} else {
							item.classList.remove('dark:text-yellow-300');
							item.classList.remove('text-blue-800');
						}
					});
				}
			});
		};

		const observer = new IntersectionObserver(callback, {
			root: null,
			rootMargin: '0px',
			threshold: 0.9,
		});

		sections.forEach(section => observer.observe(section));

		document.addEventListener('visibilitychange', () => {
			if (document.visibilityState === 'hidden') {
				observer.disconnect();
			} else {
				sections.forEach(section => observer.observe(section));
			}
		});
	});
</script>

<style>
	nav {
		animation: nav-shadown 1s linear both;
		animation-timeline: scroll();
		animation-range: 0 1000px;
	}

	@keyframes nav-shadown {
		0% {
			box-shadow: none;
		}
		to {
			@apply shadow-lg ring-1 backdrop-blur ring-white/10;
		}
	}

	@keyframes scale-up {
		0% {
			transform: scale(0.8);
			opacity: 0;
		}
		100% {
			transform: scale(1);
			opacity: 1;
		}
	}

	.animate-scale-up {
		animation: scale-up 0.3s ease-out forwards;
	}

	/* Asegurar que el tooltip se muestra sobre otros elementos */
	.group:hover .group-hover\:visible {
		z-index: 50;
	}

	/* Mobile menu animation */
	#mobile-menu {
		transition: all 0.3s ease-in-out;
	}

	#mobile-menu.hidden {
		transform: translateY(-10px);
		opacity: 0;
	}
</style>
